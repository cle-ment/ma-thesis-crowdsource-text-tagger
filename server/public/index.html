<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Clemens thesis data</title>

    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css">
    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <!-- local assets -->
    <script src="./assets/tag-it/js/tag-it.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css">
    <link href="./assets/tag-it/css/jquery.tagit.css" rel="stylesheet" type="text/css">
    <script src="./assets/jquery-Mustache/jquery.mustache.js"></script>
    <script src="./assets/mustache/mustache.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>

    <div class="container">

      <div class="row">
        <div class="col-md-12">
          <h1>Clemens' Thesis - Job Ad Tagger</h1>
          <p class="lead">Describe what each paragraph is about by adding a tag
             or keyword in the field on the right to it.</p>
          <p>
            <strong>Tips:</strong> You can ignore empty pararaphs. Don't hesitate to use the same
            keywords / tags if you think the paragraph talks about the same
            thing.
          </p>
          <p>
            <strong>Want another ad?</strong> If the page looks funky (broken)
            or the ad is too long, simply reload the page to get another one.
          </p>
        </div>
      </div>

    </div><!-- /.container -->

    <form id="tagsform">

      <div id="jobad" style="background: #f4f4f4; margin-top: 2em; padding-top: 1em">
      </div>

      <div class="container" style="padding: 2em 0">
        <div class="row">
          <div class="col-md-8">
            <strong>Done?</strong> Click the save button on the right
             to save your tags. And thanks so much!
          </div>
          <div class="col-md-4">
            <button type="submit" class="btn btn-default">Save my tags</button>
          </div>
        </div>
      </div>

    </form>

    <script type="text/javascript">
      $(document).ready(function() {
        $(".tags").tagit({
          allowSpaces: true,
          placeholderText: "Your tag(s)",
          availableTags: ["requirements", "job title"],
          autocomplete: {delay: 0, minLength: 2}
        });
      });
    </script>
    <script type="text/javascript">
    $.ajax({
      url: "http://localhost:3000/api/chunkedAds/random",
      cache: false,
      dataType: 'json'
      })
      .done(function( result ) {
        result.counter = 0;
        result.count = function () {
          return function (text, render) {
              // note that counter is in the enclosing scope
              return result.counter++;
          }}
        console.log(result)
        $.Mustache.load('./templates/chunks.html')
          .done(function () {
            $('#jobad').mustache('chunklist', result);
            initAutoComplete();
          });
      });
    </script>
    <script type="text/javascript">
    $( "#tagsform" ).on( "submit", function( event ) {
      event.preventDefault();
      var datastring = $("#tagsform").serialize();
        $.ajax({
            type: "POST",
            url: "http://localhost:3000/api/tags",
            data: datastring,
            success: function(data) {
              console.log("Data sent.")
            }
        });
      });
    </script>
    <script>
    function initAutoComplete () {
      $(function() {
        var cache = {};
        $( ".form-control.tagsinput" ).autocomplete({
          minLength: 2,
          source: function( request, response ) {
            var term = request.term;
            if ( term in cache ) {
              response( cache[ term ] );
              return;
            }
            $.getJSON( "http://localhost:3000/api/tags/byContent/" + term,
            request, function( data, status, xhr ) {
              setTimeout(function(){ }, 1000);
              console.log(data)
              cache[ term ] = data;
              response( data );
            });
          }
        });
      });
    }
    </script>
  </body>
</html>
