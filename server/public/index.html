<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Clemens thesis data</title>

    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css">
    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <!-- local assets -->
    <script src="./assets/tag-it/js/tag-it.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css">
    <link href="./assets/tag-it/css/jquery.tagit.css" rel="stylesheet" type="text/css">
    <script src="./assets/jquery-Mustache/jquery.mustache.js"></script>
    <script src="./assets/mustache/mustache.js"></script>

    <!-- site-specific scripts & styles -->
    <script src="./js/autocomplete.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/style.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>

    <div class="container">

      <div class="row">
        <div class="col-md-12">
          <h1>Help me tag these job ads</h1>
          <p class="lead">Below is a job ad split into sections.
            Describe what each section is about by
            adding one or more tags/keywords to it.
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12" >
          <div class="alert alert-success" role="alert" id="message"
            style="display:none"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12" >
          <p>
            <h4>Hints</h4>
            <ul>
              <li>Ignore empty sections</li>
              <li>Add more tags if a section talks about multiple things</li>
              <li>Seperate tags with comma (e.g. "practical info, contact")</li>
              <li>Don't hesitate to use the same tag several times</li>
            </ul>
          </p>
          <p>
            <h4>Want another job ad?</h4>
            Don't like this job ad? Too long? Click the botton below:
          </p>
          <p>
            <button class="btn btn-primary" type="submit"
             id="newad">Get another job ad</button>
          </p>
        </div>
      </div>

    </div><!-- /.container -->

    <form id="tagsform">

      <div id="jobad" style="background: #f4f4f4; margin-top: 2em; padding-top: 1em">
      </div>

      <div class="container" style="padding-bottom: 2em; padding-top: 2em">
        <div class="row">
          <div class="col-md-8">
            <strong>Done?</strong> Click the save button on the right
             to save your tags.
          </div>
          <div class="col-md-4">
            <button type="submit" class="btn btn-success">Save my tags</button>
          </div>
        </div>
      </div>
    </form>

    <script type="text/javascript">

    var taggedAdsCounter = 0;

    getRandomJobAd();

    $('#newad').click(function() {
      getRandomJobAd();
    });

    function getRandomJobAd() {
      $.ajax({
        url: "http://" + window.location.hostname + ":8082/api/chunks/byAdId/random",
        cache: false,
        dataType: 'json'
      })
      .done(function( result ) {
        result.counter = 0;
        result.count = function () {
          return function (text, render) {
            // note that counter is in the enclosing scope
            return result.counter++;
          }}
          $.Mustache.load('./templates/chunks.html')
          .done(function () {
            $('#jobad').mustache('chunklist', result, { method: 'html' });
            initAutoComplete();
          });
        });
    }

    $( "#tagsform" ).on( "submit", function( event ) {
      event.preventDefault();
      var datastring = $("#tagsform").serialize();
        $.ajax({
            type: "POST",
            url: "http://" + window.location.hostname + ":8082/api/tags",
            data: datastring,
            success: function(data) {
              taggedAdsCounter += 1;
              console.log("Data sent.");
              getRandomJobAd();

              $('#message').hide();
              if (taggedAdsCounter == 1) {
                $('#message').html("<p><strong>Thanks!!! &hearts;</strong>"
                  + " Your tags were saved. </p><p>Want to tag another job ad?"
                  + " That would be great! There's a new one ready "
                  + "for you below.</p>");
                $('#message').show();
              } else if (taggedAdsCounter <= 5) {
                $('#message').html("<p><strong>Thanks again! &hearts;</strong>"
                  + " Your tags were saved. </p><p>Another one? It's ready "
                  + "for you below.</p>");
                $('#message').show();
              } else if (taggedAdsCounter > 5) {
                $('#message').html("<p><strong>Wow you're awesome!!!</strong>"
                  + " Everything is saved. </p><p>Still Another one? "
                  + "As always ready for you below.</p>");
                $('#message').show();
              }
              window.scrollTo(0, 0);
            }
        });
      });
    </script>
  </body>
</html>
